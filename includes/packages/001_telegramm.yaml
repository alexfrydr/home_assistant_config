telegramm:
    sensor:
      - platform: template
        sensors:
          unavailable_now_light:
            friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤ - "
            value_template: "{{states.light | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:lightbulb-off        

          unavailable_now_switch:
            friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–ª–µ - "
            value_template: "{{states.switch | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:light-switch 
            
          unavailable_now_sensor:
            friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ - "
            value_template: "{{states.sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:motion-sensor-off
            
          unavailable_now_binary_sensor:
            friendly_name: "–í—Å–µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ - "
            value_template: "{{states.binary_sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:leak-off

    script:
      send_message_1:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
        sequence:
        - service: telegram_bot.send_message
          data:
            message: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è - {{ states('sensor.time') }} . –í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ"
  
      system_report:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã"
        sequence:
         - service: telegram_bot.send_message
           data:
             message: | 
                 üì¢  *–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´*
                 üóí –û—Ç—á–µ—Ç –∑–∞ {{ states('sensor.time') }}
                 üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CPU - {{ states('sensor.processor_temperature') }} ¬∞C
                 üí° –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_light') }} 
                 üîß  –°–≤–∏—á–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_switch') }} 
                 üîß  –°–µ–Ω—Å–æ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_sensor') }} 
                 üîß  –ë–∏–Ω–∞—Ä–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ - {{ states('sensor.unavailable_now_binary_sensor') }}
                 
      temp_report:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ –¥–æ–º–µ"
        sequence:
         - service: telegram_bot.send_message
           data:
             message: | 
                 üå° –£–ª–∏—Ü–∞:  {{ states('sensor.outdoor_temperature') }} ¬∞C
                 üå° –î–µ—Ç—Å–∫–∞—è:  {{ states('sensor.aqara_t_h_child_room_temperature') }} ¬∞C
                 üå° –ì–æ—Å—Ç–∏–Ω–Ω–∞—è:  {{ states('sensor.aqara_t_h_living_room_temperature') }} ¬∞C
                 üå° –°–ø–∞–ª—å–Ω—è:  {{ states('sensor.aqara_t_h_bedroom_temperature') }} ¬∞C
                 üå° –í–∞–Ω–Ω–∞—è:  {{ states('sensor.aqara_t_h_bathroom_temperature') }} ¬∞C
                 
      report_home:
        alias: "Pakage: –°—Ç–∞—Ç—É—Å –î–æ–º–∞"
        sequence:
         - service: telegram_bot.send_message
           data:
             message: | 
                 {{'\U0001F6AA'}} –í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å - {% if is_state('binary_sensor.door_window_contact_sensor_hallway_contact', 'on') %} –û—Ç–∫—Ä—ã—Ç–∞ {% else %} –ó–∞–∫—Ä—ã—Ç–∞ {% endif %}
                 {{'\U0001F57A'}} –î–≤–∏–∂–µ–Ω–∏–µ –≤ –¥–æ–º–µ - {% if is_state('binary_sensor.motion_in_home', 'on') %} –ï—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ {% else %} –ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è {% endif %}
                 {{'\U0001F9FB'}} –í–∞–Ω–Ω–∞—è - {% if is_state('binary_sensor.water_leak_sensor_bathroom_water_leak', 'on') %} –í–ª–∞–∂–Ω–æ {% else %} –°—É—Ö–æ {% endif %}
                 {{'\U0001F4A7'}} –ö—É—Ö–Ω—è - {% if is_state('binary_sensor.water_leak_sensor_kitchen_water_leak', 'on') %} –í–ª–∞–∂–Ω–æ {% else %} –°—É—Ö–æ {% endif %}

      home_away_report:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ —É—Ö–æ–¥—è –∏–∑ –¥–æ–º–∞"
        sequence:
         - service: telegram_bot.send_message
           data:
             title: "–ü–æ–∫–∞ üëã"
             message: |
                  –î–æ —Å–∫–æ—Ä–æ–π –≤—Å—Ç—Ä–µ—á–∏!üò¢
        #  - service: telegram_bot.send_message
        #   data:
        #      message: >-
        #         {% set window_sensors = {
        #           "–Ω–∞ –∫—É—Ö–Ω–µ": is_state("binary_sensor.door_window_contact_sensor_kitchen_contact", "on")
        #         } %}
        #         {% set data = namespace(text=[]) %}
        #         {% for k in window_sensors if window_sensors[k] == true %}
        #           {% if loop.first %}
        #             {% set data.text = data.text + [["–ö—Å—Ç–∞—Ç–∏,", "–ù–µ –∑–∞–±—É–¥—å—Ç–µ, —á—Ç–æ", "–ù–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ"]|random] + [" —É –≤–∞—Å"] + [[" –æ—Ç–∫—Ä—ã—Ç–æ", " –Ω–µ –∑–∞–∫—Ä—ã—Ç–æ"]|random] + [" –æ–∫–Ω–æ"] %}
        #           {% endif %}
        #           {% if not loop.first and not loop.last %}
        #             {% set data.text = data.text + [", "] + [k] %}
        #           {% elif loop.last and not loop.first %}
        #             {% set data.text = data.text + [" –∏ "] + [k] %}
        #           {% else %}
        #             {% set data.text = data.text + [" "] + [k] %}
        #           {% endif %}
        #         {% endfor %}
        #         {{ data.text|join("") }}

      home_arrived_report:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–∏–±—ã—Ç–∏–∏ –¥–æ–º–æ–π –ê–ª–µ–∫—Å–µ–π"
        sequence:
         - service: telegram_bot.send_message
           data:
             title: "–ü—Ä–∏–≤–µ—Ç–∏–∫–∏ üëã"
             message: |
                 –ê–ª–µ–∫—Å–µ–π, –≤—ã –≤ –¥–æ–º–∞—à–Ω–µ–π –∑–æ–Ω–µ üéâ
                 
      home_arrived_report_viktoriya:
        alias: "Pakage: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–∏–±—ã—Ç–∏–∏ –¥–æ–º–æ–π –í–∏–∫—Ç–æ—Ä–∏—è"
        sequence:
         - service: telegram_bot.send_message
           data:
             title: "–ü—Ä–∏–≤–µ—Ç–∏–∫–∏ üëã"
             message: |
                 –í–∏–∫—Ç–æ—Ä–∏—è, –≤—ã –≤ –¥–æ–º–∞—à–Ω–µ–π –∑–æ–Ω–µ üéâ

      telegramm_keyboard_start:
        alias: "Pakage: C—Ç–∞—Ä—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"
        sequence:
          - service: telegram_bot.send_message
            data:
                message: >
                    {{ [
                    "–ü—Ä–∏–≤–µ—Ç–∏–∫–∏",
                    "–ö –∑–≤–µ–∑–¥–∞–º!",
                    "–°–µ—Ä, –î–∞ —Å–µ—Ä!",
                    "–ó–¥–æ—Ä–æ–≤–µ–Ω—å–∫–∏ –±—ã–ª–∏!",
                    "–í–µ—á–µ—Ä –≤ —Ö–∞—Ç—É!",
                    "–ó–¥—Ä–∞—Å—Ç–∏!",
                    "–®–æ —Ç–∞–∫–æ–µ?",
                    "–ü–æ–µ—Ö–∞–ª–∏",
                    "–•–µ–ª–ª–æ –∞–º–∏–≥–æ",
                    "–ë—É–µ–Ω–æ—Å –Ω–æ—á–µ—Å!"
                    ] | random }}       
                data:
                inline_keyboard:
                  - 'üóí –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:/report, {{"\U0001F3E0"}} –°—Ç–∞—Ç—É—Å –¥–æ–º–∞:/temp' 
                  - 'üîí¬†–ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –æ—Ö—Ä–∞–Ω—É:/armed, üîí¬†–°–Ω—è—Ç—å —Å –æ—Ö—Ä–∞–Ω—ã:/disarm'
                  - 'üîò –ù–∞—á–∞—Ç—å —É–±–æ—Ä–∫—É:/clean, üîò –ó–∞–∫–æ–Ω—á–∏—Ç—å —É–±–æ—Ä–∫—É:/clean_stop'
                  - 'üí° –í—ã–∫–ª—é—á–∏—Ç—å –≤—Å—ë:/turn_off'
             
    automation:   
        - alias: "Pakage: start_message"
          initial_state: true
          trigger:   
             - platform: homeassistant
               event: start          
          action:          
             - service: telegram_bot.send_message
               data:
                 message: | 
                     üì¢ *–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´* 
                     üìù  –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤ {{ states('sensor.time') }} 
                     üëâ  –û—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É...            
             - delay: 00:01:10
             - service: script.turn_on
               entity_id: script.system_report
             - delay: 00:01:20
             - service: script.turn_on
               entity_id: script.telegramm_keyboard_start

        - alias: "Pakage: arrived_home_alex"
          trigger:
          - platform: zone
            entity_id: person.alex
            zone: zone.home
            event: enter
          action:
             - service: script.turn_on
               entity_id: script.home_arrived_report
               
        - alias: "Pakage: arrived_home_viktoriya"
          trigger:
              - platform: zone
                entity_id: person.victoriya
                zone: zone.home
                event: enter
          action:
             - service: script.turn_on
               entity_id: script.home_arrived_report_viktoriya

        - alias: "Pakage: send_report"
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_callback
            event_data:
              command: '/report'
          action:
           - service: script.turn_on
             entity_id: 
                - script.system_report

        - alias: "Pakage: send_temp"
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_callback
            event_data:
              command: '/temp'
          action:
           - service: script.turn_on
             entity_id: 
                - script.report_home
                - script.temp_report

        - alias: "Pakage: send_vacuum_clean"
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_callback
            event_data:
              command: '/clean'                
          action:
          - device_id: 0becfdd23f8e874142bdc8a3bf15df57
            domain: vacuum
            entity_id: 7e1b21955d240e260cc6153548dc9d93
            type: clean
            
        - alias: "Pakage: send_vacuum_clean_stop"
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_callback
            event_data:
              command: '/clean_stop'                
          action:
          - device_id: 0becfdd23f8e874142bdc8a3bf15df57
            domain: vacuum
            entity_id: 7e1b21955d240e260cc6153548dc9d93
            type: dock

        - alias: "Pakage: telegram_keyboard"
          initial_state: true
          trigger:
            platform: event
            event_type: telegram_command
            event_data:
              command: '/start'
          action:
           - service: script.turn_on
             entity_id: 
                - script.telegramm_keyboard_start
                
        - alias: "Pakage: send_turn_off_stop"
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_callback
            event_data:
              command: '/turn_off'                
          action:
           - service: script.turn_on
             entity_id: 
                - script.turn_off_away_person
                
        - alias: "Pakage: system_status_query"
          initial_state: true
          trigger:
              - platform: event
                event_type: telegram_text
          condition:
              - condition: template
                value_template: >-
                  {{ trigger.event.data.text in ["–∫–ª–∞–≤–∞", "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞", "–ö–ª–∞–≤–∞", "–∫—É–∫—É", "Rere", "rere", "–ü—Ä–∏–≤–µ—Ç", "–ø—Ä–∏–≤–µ—Ç", "Ghbdtn", "ghbdtn"] }}
          action:
           - service: script.turn_on
             entity_id: 
                - script.telegramm_keyboard_start
                
        - alias: "Pakage: send_turn_off_stop_notify"
          trigger:
            platform: event
            event_type: telegram_callback
            event_data:
              command: '/turn_off'
          action:
            - service: telegram_bot.send_message
              data_template:
                message: "–ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. –í—ã–∫–ª—é—á–∏—Ç—å –≤—Å—ë."
