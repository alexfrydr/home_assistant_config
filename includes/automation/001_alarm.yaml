- alias: '001_Trigger_alarm_while_armed_away'
  description: "–¢—Ä–µ–≤–æ–≥–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ö—Ä–∞–Ω–∞ –Ω–µ –¥–æ–º–∞"
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
      to: 'on'
    - platform: state
      entity_id: binary_sensor.door_window_contact_sensor_kitchen_contact
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_away
  action:
    service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.home_alarm
    
- alias: '001_Send_notification_when_alarm_triggered'
  description: "–¢—Ä–µ–≤–æ–≥–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ö—Ä–∞–Ω–∞ –Ω–µ –¥–æ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    - platform: state
      entity_id: alarm_control_panel.home_alarm
      to: 'triggered'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: |
              ‚ö†Ô∏è –°—Ä–∞–±–æ—Ç–∞–ª–∞ —Ç—Ä–µ–≤–æ–≥–∞!

- alias: '001_Send_notification_when_alarm_is_Disarmed'
  description: "–°–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    - platform: state
      entity_id: alarm_control_panel.home_alarm
      to: 'disarmed'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: |
              üîì¬† –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–Ω—è—Ç–∞ —Å –æ—Ö—Ä–∞–Ω—ã –≤ {{ states('sensor.date_time') }}
              
- alias: '001_Send_notification_when_alarm_is_in_pending_status'
  description: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    - platform: state
      entity_id: alarm_control_panel.home_alarm
      to: 'arming'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: |
              üîë  –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –≤ {{ states('sensor.date_time') }}"

- alias: '001_Send_notification_when_alarm_is_Armed_in_Away_mode'
  description: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–µ–∂–∏–º–µ –ù–µ –¥–æ–º–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    - platform: state
      entity_id: alarm_control_panel.home_alarm
      to: 'armed_away'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: |
           üîí¬†  –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Ä–µ–∂–∏–º–µ ¬´–ù–µ –¥–æ–º–∞¬ª {{ states('sensor.date_time') }}"
           
- alias: '001_Send_notification_when_alarm_is_Armed_in_Home_mode'
  description: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –¥–æ–º–∞—à–Ω–µ–º —Ä–µ–∂–∏–º–µ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    - platform: state
      entity_id: alarm_control_panel.home_alarm
      to: 'armed_home'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: |
              üîè  –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤ –¥–æ–º–∞—à–Ω–µ–º —Ä–µ–∂–∏–º–µ {{ states('sensor.date_time') }}

- alias: '001_Trigger_alarm_while_armed_home'
  description: "–¢—Ä–µ–≤–æ–≥–∞ –≤ —Ä–µ–∂–∏–º–µ –¥–æ–º–∞"
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
      to: 'on'
  condition:
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: armed_home
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    service: alarm_control_panel.alarm_trigger
    entity_id: alarm_control_panel.home_alarm
    
- alias: "001_Security:_door_has_been_open_for_more_than_5_minutes"
  description: "–¢—Ä–µ–≤–æ–≥–∞ –µ—Å–ª–∏ –≤—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞ –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç"
  trigger:
    platform: state
    entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
    from: "off"
    to: "on"
    for: "00:05:00"
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - repeat:
        while:
          - condition: state
            entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
            state: 'on'
          - condition: state
            entity_id: input_boolean.control_mode
            state: 'on'
        sequence:
          - service: telegram_bot.send_message
            data:
               title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
               message: |
                   ‚ö† –í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–∞ –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç.
          - delay: 00:00:05
          
- alias: "001_Security:_Signaling._Forgot_to_put_it?"
  description: "–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –æ—Ö—Ä–∞–Ω—É –µ—Å–ª–∏ –Ω–∏ –∫–æ–≥–æ –Ω–µ—Ç –¥–æ–º–∞"
  trigger:
    - platform: state
      entity_id: group.persons
      from: home
      to: not_home
  condition:
    - condition: state
      entity_id: alarm_control_panel.home_alarm
      state: 'disarmed'
    - condition: state
      entity_id: group.persons
      state: not_home
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: telegram_bot.send_message
      data:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: "–ü–æ—Ö–æ–∂–µ –¥–æ–º –æ–ø—É—Å—Ç–µ–ª, —Å—Ç–∞–≤–ª—é –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—é."
        inline_keyboard:
          - '‚Ü© –û—Ç–º–µ–Ω–∏—Ç—å?:/disarm'
    - delay: 00:00:02
    - service: script.turn_on
      entity_id: script.home_away_report
    - delay: 00:00:02
    - service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.home_alarm

          
- alias: "001_Security:_Signaling._Cancellation"
  description: "–û—Ç–º–µ–Ω–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ –æ—Ö—Ä–∞–Ω—É –∫–æ–º–∞–Ω–¥–æ–π –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      command: '/disarm'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.home_alarm
    - service: telegram_bot.send_message
      data_template:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: "–ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—é."
        
- alias: "001_Security:_Signaling._Armed"
  description: "–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –æ—Ö—Ä–∞–Ω—É –∫–æ–º–∞–Ω–¥–æ–π –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º"
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      data: '/armed'
  condition:
    - condition: state
      entity_id: input_boolean.control_mode
      state: 'on'
  action:
    - service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.home_alarm
    - service: telegram_bot.send_message
      data_template:
        title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–ò:*'
        message: "–ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—é."
        
- alias: "001_Security:_Signaling._disarming"
  description: "–°–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã –ø—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω –≤ –¥–æ–º–∞—à–Ω–µ–π –∑–æ–Ω–µ –∏ —Å—Ç–∞—Ç—É—Å–µ –æ—Ö—Ä–∞–Ω—ã –≤ –æ–∂–∏–¥–∞–Ω–∏–∏"
  trigger:
  - platform: geo_location
    source: group.persons
    zone: zone.home
    event: enter
  condition:
      - condition: state
        entity_id: 'alarm_control_panel.home_alarm'
        state: 'pending'
  action:
      - service: alarm_control_panel.alarm_disarm
        entity_id: alarm_control_panel.home_alarm

- alias: "001_Security:_Signaling._disarming_door_open"
  description: "–°–Ω—è—Ç–∏–µ —Å –æ—Ö—Ä–∞–Ω—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–≤–µ—Ä–∏ –∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω –≤ –¥–æ–º–∞—à–Ω–µ–π –∑–æ–Ω–µ"
  trigger:
    - platform: state
      entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
      to: 'on'
  condition:
    - condition: state
      entity_id: 'alarm_control_panel.home_alarm'
      state: 'armed_away'
    - condition: state
      entity_id: group.persons
      state: home
  action:
      - service: alarm_control_panel.alarm_disarm
        entity_id: alarm_control_panel.home_alarm

