# -----------------------------------------------------------
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞–º–∏ –ø—Ä–æ—Ç–µ—á–∫–∏
# -----------------------------------------------------------

- alias: "006_temporarily_disable_notification"
  description: "–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–µ—á–∫–µ"
  trigger:
    platform: event
    event_type: telegram_callback
    event_data:
      command: '/disable_notification_leak'
  condition: []
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.water_mode_alarm
  - service: telegram_bot.send_message
    data:
      title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
      message: |
           ‚ö†  –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ç–µ—á–∫–∏ –Ω–∞ 1 —á–∞—Å.
  - delay: 01:00:00
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.water_mode_alarm
  - service: telegram_bot.send_message
    data:
      title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
      message: |
           ‚ö†  –†–µ–∂–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ç–µ—á–∫–∏ –≤–∫–ª—é—á–µ–Ω.

- alias: "006_Alarm_Aqara_water_sensor_bathroom_ON"
  description: "–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–µ—á–∫–µ –≤ –≤–∞–Ω–Ω–æ–π"
  trigger:
    platform: state
    entity_id: binary_sensor.water_leak_sensor_bathroom_water_leak
    to: "on"
  condition: []
  action:
    - repeat:
        while:
          - condition: state
            entity_id: binary_sensor.water_leak_sensor_bathroom_water_leak
            state: 'on'
          - condition: state
            entity_id: input_boolean.water_mode_alarm
            state: 'on'
        sequence:
          - service: telegram_bot.send_message
            data:
              title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
              message: "‚ö†  –ü—Ä–æ—Ç–µ—á–∫–∞ –≤ –≤–∞–Ω–Ω–æ–π"
              inline_keyboard: 
                - '–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å?:/disable_notification_leak'
          - service: script.turn_on
            entity_id: 
                - script.yandex_tts3
          - service: media_player.play_media
            data_template:
                entity_id: media_player.mpd
                media_content_id: "http://10.123.10.84:8123/local/sound/alarm_2.mp3"
                media_content_type: 'music'
          - delay: 00:01:00

- alias: "006_Alarm_Aqara_water_sensor_bathroom_OFF"
  description: '–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ç–µ—á–∫–∏ –≤ –≤–∞–Ω–Ω–æ–π'
  trigger:
    entity_id: binary_sensor.water_leak_sensor_bathroom_water_leak
    platform: state
    to: 'off'
  condition: []
  action:
    - service: telegram_bot.send_message
      data_template:
        title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
        message: | 
             ‚ö†  –ü—Ä–æ—Ç–µ—á–∫–∞ –≤ –≤–∞–Ω–Ω–æ–π —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞!
    - service: script.turn_on
      entity_id: 
         - script.yandex_tts5

- alias: "006_Alarm_Aqara_water_sensor_kitchen_ON"
  description: "–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–µ—á–∫–µ –Ω–∞ –∫—É—Ö–Ω–µ"
  trigger:
    entity_id: binary_sensor.water_leak_sensor_kitchen_water_leak
    platform: state
    to: 'on'
  condition: []
  action:
    - repeat:
        while:
          - condition: state
            entity_id: binary_sensor.water_leak_sensor_kitchen_water_leak
            state: 'on'
          - condition: state
            entity_id: input_boolean.water_mode_alarm
            state: 'on'
        sequence:
          - service: telegram_bot.send_message
            data:
              title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
              message: "‚ö†  –ü—Ä–æ—Ç–µ—á–∫–∞ –Ω–∞ –∫—É—Ö–Ω–µ"
              inline_keyboard: 
                - '–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å?:/disable_notification_leak'
          - service: script.turn_on
            entity_id: 
                - script.yandex_tts4
          - service: media_player.play_media
            data_template:
                entity_id: media_player.mpd
                media_content_id: "http://10.123.10.84:8123/local/sound/alarm_2.mp3"
                media_content_type: 'music'
          - delay: 00:01:00
             
- alias: "006_Alarm_Aqara_water_sensor_kitchen_OFF"
  description: '–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ç–µ—á–∫–∏ –Ω–∞ –∫—É—Ö–Ω–µ'
  trigger:
    entity_id: binary_sensor.water_leak_sensor_kitchen_water_leak
    platform: state
    to: 'off'
  condition: []
  action:
    - service: telegram_bot.send_message
      data_template:
        title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
        message: | 
             ‚ö†  –ü—Ä–æ—Ç–µ—á–∫–∞ –Ω–∞ –∫—É—Ö–Ω–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ 
    - service: script.turn_on
      entity_id: 
         - script.yandex_tts5
    
