# -----------------------------------------------------------
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –£–ü–° 
# (–≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
# -----------------------------------------------------------

- alias: "008_APC: –ü–∏—Ç–∞–Ω–∏–µ –æ—Ç –±–∞—Ç–∞—Ä–µ–∏"
  trigger:
  - platform: state
    entity_id: binary_sensor.ups_online_status
    from: 'on'
    to: 'off'
  action:
  - service: telegram_bot.send_message
    data:
      title: "‚ö° –ü–∏—Ç–∞–Ω–∏–µ –æ—Ç –±–∞—Ç–∞—Ä–µ–∏!"
      message: |
        üîã –ó–∞—Ä—è–¥: {{ states('sensor.ups_battery') }}%
        ‚è± –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: {{ states('sensor.ups_time_left') }} –º–∏–Ω
        üîå –ù–∞–≥—Ä—É–∑–∫–∞: {{ states('sensor.ups_load') }}%
        
- alias: "008_APC: –ü–∏—Ç–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
  trigger:
  - platform: state
    entity_id: binary_sensor.ups_online_status
    from: 'off'
    to: "on"
  action:
  - service: telegram_bot.send_message
    data:
      title: "‚úÖ –ü–∏—Ç–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
      message: |
        –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –æ—Ç –±–∞—Ç–∞—Ä–µ–∏: {{ states('sensor.ups_time_on_battery') }}
        –¢–µ–∫—É—â–∏–π –∑–∞—Ä—è–¥: {{ states('sensor.ups_battery') }}%
        
- alias: "008_APC: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç"
  description: "–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ UPS –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é"
  trigger:
    - platform: time
      at: "08:00:00"
  condition:
    - condition: time
      weekday:
        - mon  # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 
  action:
    - service: telegram_bot.send_message
      data:
        message: |
          üìä *–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç UPS*
        
          üîã –¢–µ–∫—É—â–∏–π –∑–∞—Ä—è–¥: {{ states('sensor.ups_battery') }}%
          ‚ö° –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: {{ states('sensor.ups_transfer_count') }}
          üïí –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ—Ö–æ–¥: {{ states('sensor.ups_last_transfer') }}
          üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {{ states('sensor.ups_internal_temperature') }}¬∞C
          üîå –¢–µ–∫—É—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: {{ states('sensor.ups_load') }}%
          ‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –æ—Ç –±–∞—Ç–∞—Ä–µ–∏: {{ states('sensor.ups_time_on_battery') }}

- alias: "008_APC: –ü–µ—Ä–µ–≥—Ä–µ–≤ UPS"
  trigger:
  - platform: numeric_state
    entity_id: sensor.ups_internal_temperature
    above: 40
  action:
  - service: telegram_bot.send_message
    data:
      title: "üå° –ü–µ—Ä–µ–≥—Ä–µ–≤ UPS!"
      message: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ {{ states('sensor.ups_internal_temperature') }}¬∞C"
      
- alias: "008_APC: –ó–∞–º–µ–Ω–∞ –±–∞—Ç–∞—Ä–µ–∏"
  trigger:
  - platform: template
    value_template: >
      {{ as_timestamp(now()) - as_timestamp(states.sensor.ups_battery_replaced.last_changed) > 31536000 }}
  action:
  - service: telegram_bot.send_message
    data:
      title: "–ó–∞–º–µ–Ω–∞ –±–∞—Ç–∞—Ä–µ–∏ UPS"
      message: "–ë–∞—Ç–∞—Ä–µ—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ–ª–µ–µ 1 –≥–æ–¥–∞"
      
- alias: "008_APC: –ù–µ—É–¥–∞—á–Ω—ã–π —Å–∞–º–æ—Ç–µ—Å—Ç"
  trigger:
    - platform: state
      entity_id: sensor.ups_last_self_test
  condition:
    - condition: template
      value_template: >
        {{ 'FAILED' in states('sensor.ups_last_self_test') | upper }}
  action:
    - service: telegram_bot.send_message
      data:
        message: |
          ‚ùó *–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∞–º–æ—Ç–µ—Å—Ç–∞ UPS: –ù–ï–£–î–ê–ß–ù–û!*
          üîç –î–∞–Ω–Ω—ã–µ: {{ states('sensor.ups_last_self_test') }}
        parse_mode: markdown
        
- alias: "APC: –ù–∏–∑–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ç–∏"
  trigger:
  - platform: numeric_state
    entity_id: sensor.ups_line_freq
    below: 49.5
  action:
  - service: telegram_bot.send_message
    data:
      title: "‚ö†Ô∏è –ù–∏–∑–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–µ—Ç–∏!"
      message: "{{ states('sensor.ups_line_freq') }} –ì—Ü (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 50 –ì—Ü)"
        

