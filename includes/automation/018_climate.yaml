# -----------------------------------------------------------
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª–µ–º
# -----------------------------------------------------------

- alias: "018_Xiaomi_humidifier_OFF"
  description: '–í–∫–ª—é—á–µ–Ω–∏–µ —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–æ–∑–æ–Ω–µ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏'
  trigger:
  - platform: time_pattern
    minutes: '/1'
    seconds: 00
  condition:
    - condition: state
      entity_id: input_boolean.auto_fan_xiaomi_on_off
      state: 'on'
    - condition: state
      entity_id: fan.xiaomi_air_humidifier
      state: 'on'
    - type: is_humidity
      condition: device
      device_id: b8b9d5a5b339f482983a535dbd3474bc
      entity_id: sensor.aqara_t_h_living_room_humidity
      domain: sensor
      above: 40
  action:
  - service: fan.turn_off
    data: {}
    entity_id: fan.xiaomi_air_humidifier
    
# - alias: "018_Xiaomi_humidifier_binsensor_OFF"
#   description: ''
#   trigger:
#     - platform: state
#       entity_id: binary_sensor.door_window_contact_sensor_hallway_contact
#       to: 'on'
#     - platform: state
#       entity_id: binary_sensor.door_window_contact_sensor_kitchen_contact
#       to: 'on'
#   condition:
#     - condition: state
#       entity_id: input_boolean.auto_fan_xiaomi_on_off
#       state: 'on'
#     - condition: state
#       entity_id: fan.xiaomi_air_humidifier
#       state: 'on'
#   action:
#     - service: fan.turn_off
#       data: {}
#       entity_id: fan.xiaomi_air_humidifier
#     - service: telegram_bot.send_message
#       data_template:
#         title: '*–û–ü–û–í–ï–©–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´:*'
#         message: | 
#              ‚ö†  –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è, –∑–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏ {{ states('sensor.date_time') }}

- alias: "018_Xiaomi_humidifier_ON"
  description: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–∞ medium'
  trigger:
  - platform: time_pattern
    minutes: '/1'
    seconds: 00
  condition: 
    - condition: state
      entity_id: input_boolean.auto_fan_xiaomi_on_off
      state: 'on'
    - condition: state
      entity_id: fan.xiaomi_air_humidifier
      state: 'off'
    - type: is_humidity
      condition: device
      device_id: b8b9d5a5b339f482983a535dbd3474bc
      entity_id: sensor.aqara_t_h_living_room_humidity
      domain: sensor
      below: 30
  action:
  - service: fan.turn_on
    data: {}
    entity_id: fan.xiaomi_air_humidifier
  - delay: 00:00:01
  - service: fan.set_speed
    data_template:
      speed: medium
      entity_id: fan.xiaomi_air_humidifier

- alias: "018_Xiaomi_humidifier_buzzer_off"
  description: '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –±–∏–ø–µ—Ä–∞ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è'
  trigger:
  - platform: state
    entity_id: fan.xiaomi_air_humidifier
    to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.auto_fan_xiaomi_on_off
      state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    entity_id: switch.xiaomi_airpurifier_buzzer

- alias: "018_Xiaomi_humidifier_No_water"
  description: '–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å–≤–∏–∏ –≤–æ–¥—ã –≤ —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª–µ'
  trigger:
  - platform: state
    entity_id: sensor.hum_tank_state
    to: 'true'
  condition: []
  action:
    - service: telegram_bot.send_message
      data_template:
        title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
        message: | 
             ‚ö†  –í —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª–µ  –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –≤–æ–¥–∞ 
    - service: input_boolean.turn_off
      entity_id: input_boolean.auto_fan_xiaomi_on_off
    - service: media_player.volume_set
      data:
        entity_id:
        - media_player.yandex_station_540078920110102034cf
        volume_level: 0.4
    - delay: 00:00:01
    - service: tts.yandex_station_say
      entity_id: media_player.yandex_station_540078920110102034cf
      data_template:
        title: "üéâ *–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã*" 
        message: –í —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –≤–æ–¥–∞.

- alias: "018_humidifier_auto_on"
  description: '–ü–∏–∫–∞–Ω–∏–µ –±–∏–ø–µ—Ä–æ–º –æ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è'
  trigger:
  - platform: state
    entity_id: input_boolean.auto_fan_xiaomi_on_off
    to: 'on'
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    entity_id: switch.xiaomi_airpurifier_buzzer
  - delay: 00:00:01
  - service: switch.turn_off
    data: {}
    entity_id: switch.xiaomi_airpurifier_buzzer
  mode: single
  
- alias: "018_humidifier_auto_off"
  description: '–ü–∏–∫–∞–Ω–∏–µ –±–∏–ø–µ—Ä–æ–º –æ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—è'
  trigger:
  - platform: state
    entity_id: input_boolean.auto_fan_xiaomi_on_off
    to: 'off'
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    entity_id: switch.xiaomi_airpurifier_buzzer
  mode: single


  
  
